import{a as T,b as D,c as W,d as z,e as V,g as A,h as F}from"./chunk-IRGIIFUN.js";import{$a as I,Eb as R,Fb as k,Gb as w,Ja as P,Mb as q,Na as x,R as y,Ua as p,Va as n,W as u,Wa as e,X as f,Xa as O,ab as _,bb as m,fb as E,ga as S,gb as t,hb as l,ib as g,kb as b,lb as C,mb as h,sb as v,wa as r}from"./chunk-ZMHPBY6C.js";function N(s,c){if(s&1){let i=I();n(0,"tr")(1,"td")(2,"input",24),h("ngModelChange",function(o){let d=u(i).$implicit;return C(d.itemId,o)||(d.itemId=o),f(o)}),e()(),n(3,"td")(4,"input",25),h("ngModelChange",function(o){let d=u(i).$implicit;return C(d.description,o)||(d.description=o),f(o)}),e()(),n(5,"td")(6,"input",26),h("ngModelChange",function(o){let d=u(i).$implicit;return C(d.quantity,o)||(d.quantity=o),f(o)}),e()(),n(7,"td")(8,"button",27),_("click",function(){let o=u(i).index,d=m();return f(d.removeItem(o))}),t(9,"\u2715"),e()()()}if(s&2){let i=c.$implicit;r(2),b("ngModel",i.itemId),r(2),b("ngModel",i.description),r(2),b("ngModel",i.quantity)}}function K(s,c){if(s&1&&(n(0,"div",28)(1,"strong"),t(2,"Correlation ID:"),e(),n(3,"code"),t(4),e()()),s&2){let i=m();r(4),l(i.response.correlationId)}}function L(s,c){s&1&&(n(0,"div",29),t(1,"Waiting for response..."),e())}function Y(s,c){if(s&1&&(n(0,"tr")(1,"td"),t(2),e(),n(3,"td"),t(4),e()()),s&2){let i=c.$implicit;r(2),l(i.itemId),r(2),l(i.quantity)}}function B(s,c){if(s&1&&(n(0,"div",30)(1,"div",31)(2,"span",32),t(3,"\u2713 OK"),e(),t(4," Inventory Hold"),e(),n(5,"p")(6,"strong"),t(7,"Order ID:"),e(),t(8),e(),n(9,"p")(10,"strong"),t(11,"Correlation ID:"),e(),n(12,"code"),t(13),e()(),n(14,"table")(15,"thead")(16,"tr")(17,"th"),t(18,"Item ID"),e(),n(19,"th"),t(20,"Quantity"),e()()(),n(21,"tbody"),x(22,Y,5,2,"tr",9),e()()()),s&2){let i=m();r(8),g(" ",i.response.orderId),r(5),l(i.response.correlationId),r(9),p("ngForOf",i.response.items)}}function U(s,c){if(s&1&&(n(0,"tr")(1,"td"),t(2),e(),n(3,"td"),t(4),e(),n(5,"td"),t(6),e()()),s&2){let i=c.$implicit;r(2),l(i.itemId),r(2),l(i.quantityAsked),r(2),l(i.quantityAvailable)}}function j(s,c){if(s&1&&(n(0,"div",33)(1,"div",31)(2,"span",34),t(3,"\u2717 KO"),e(),t(4," Out of Stock"),e(),n(5,"p")(6,"strong"),t(7,"Order ID:"),e(),t(8),e(),n(9,"p")(10,"strong"),t(11,"Correlation ID:"),e(),n(12,"code"),t(13),e()(),n(14,"table")(15,"thead")(16,"tr")(17,"th"),t(18,"Item ID"),e(),n(19,"th"),t(20,"Asked"),e(),n(21,"th"),t(22,"Available"),e()()(),n(23,"tbody"),x(24,U,7,3,"tr",9),e()()()),s&2){let i=m();r(8),g(" ",i.response.orderId),r(5),l(i.response.correlationId),r(11),p("ngForOf",i.response.outOfStockItems)}}function Q(s,c){if(s&1&&(n(0,"div",35)(1,"div",31)(2,"span",36),t(3,"\u26A0 ERROR"),e(),t(4," Service Error"),e(),n(5,"p")(6,"strong"),t(7,"Order ID:"),e(),t(8),e(),n(9,"p")(10,"strong"),t(11,"Correlation ID:"),e(),n(12,"code"),t(13),e()(),n(14,"p")(15,"strong"),t(16,"Error ID:"),e(),n(17,"code"),t(18),e()(),n(19,"p",37),t(20),e()()),s&2){let i=m();r(8),g(" ",i.response.orderId),r(5),l(i.response.correlationId),r(5),l(i.response.errorCorrelationId),r(2),l(i.response.errorMessage)}}function H(s,c){if(s&1&&(n(0,"div",38)(1,"div",31)(2,"span",39),t(3,"\u23F1 TIMEOUT"),e(),t(4," Request Timeout"),e(),n(5,"p")(6,"strong"),t(7,"Order ID:"),e(),t(8),e(),n(9,"p")(10,"strong"),t(11,"Correlation ID:"),e(),n(12,"code"),t(13),e()(),n(14,"p",40),t(15,"The request timed out after 60 seconds."),e()()),s&2){let i=m();r(8),g(" ",i.response.orderId),r(5),l(i.response.correlationId)}}function J(s,c){if(s&1){let i=I();n(0,"button",41),_("click",function(){u(i);let o=m();return f(o.clearResponse())}),t(1,"Clear"),e()}}var re=(()=>{class s{constructor(){this.http=y(q),this.wsService=y(T),this.cdr=y(v),this.isSending=!1,this.isConnected=S(!1),this.request={orderId:"ORD-9393",items:[{itemId:"ITEM-001",description:"Widget A",quantity:10},{itemId:"ITEM-002",description:"Widget B",quantity:5}]},this.response={correlationId:"",type:null}}ngOnInit(){this.wsService.connect(),this.isConnected.set(this.wsService.isConnected()),this.wsService.getConnectionStatus().subscribe(i=>{console.log("RequestReply: WebSocket connection status changed:",i),this.isConnected.set(i),this.cdr.detectChanges()}),this.wsSubscription=this.wsService.getEvents().subscribe(i=>{if(console.log("RequestReply: Received WebSocket event:",i),this.isConnected.set(!0),i.details&&i.details.startsWith("REQUEST_REPLY_RESPONSE:"))try{let a=i.details.substring(23),o=JSON.parse(a);this.handleResponse(o)}catch(a){console.error("Error parsing Request/Reply response:",a)}})}ngOnDestroy(){this.wsSubscription?.unsubscribe()}addItem(){this.request.items.push({itemId:"",description:"",quantity:1})}removeItem(i){this.request.items.splice(i,1)}sendRequest(){this.isSending=!0,this.response={correlationId:"",type:null};let i={orderId:this.request.orderId,items:this.request.items};this.http.post("http://localhost:8080/api/request-reply/send",i).subscribe({next:a=>{console.log("Request sent, correlation ID:",a.correlationId),this.response.correlationId=a.correlationId,this.isSending=!1,this.cdr.detectChanges()},error:a=>{console.error("Error sending request:",a),this.isSending=!1,alert("Error sending request: "+a.message)}})}clearResponse(){this.response={correlationId:"",type:null},this.cdr.detectChanges()}handleResponse(i){if(console.log("Handling response:",i),i.correlationId!==this.response.correlationId){console.log("Ignoring response for different correlation ID");return}switch(this.response.type=i.responseType,this.response.orderId=i.orderId,i.responseType){case"OK":this.response.items=i.items;break;case"KO":this.response.outOfStockItems=i.outOfStockItems;break;case"ERROR":this.response.errorCorrelationId=i.errorCorrelationId,this.response.errorMessage=i.errorMessage;break;case"TIMEOUT":break}this.cdr.detectChanges()}static{this.\u0275fac=function(a){return new(a||s)}}static{this.\u0275cmp=P({type:s,selectors:[["app-request-reply"]],decls:60,vars:16,consts:[[1,"container"],[1,"grid"],[1,"card"],[1,"card-header","request-header"],[1,"card-title"],[1,"card-content"],[1,"stream-info"],[1,"form-group"],["type","text","placeholder","ORD-12345",3,"ngModelChange","ngModel"],[4,"ngFor","ngForOf"],[1,"btn-add",3,"click"],[1,"btn-send",3,"click","disabled"],[1,"btn-icon"],["class","correlation-id",4,"ngIf"],[1,"card-header","response-header"],[1,"header-left"],[1,"connection-status"],[1,"status-dot"],["class","no-response",4,"ngIf"],["class","response response-ok",4,"ngIf"],["class","response response-ko",4,"ngIf"],["class","response response-error",4,"ngIf"],["class","response response-timeout",4,"ngIf"],["class","btn-secondary",3,"click",4,"ngIf"],["type","text","placeholder","ITEM-001",3,"ngModelChange","ngModel"],["type","text","placeholder","Widget A",3,"ngModelChange","ngModel"],["type","number","placeholder","10","min","1",3,"ngModelChange","ngModel"],[1,"btn-remove",3,"click"],[1,"correlation-id"],[1,"no-response"],[1,"response","response-ok"],[1,"response-header"],[1,"badge","badge-ok"],[1,"response","response-ko"],[1,"badge","badge-ko"],[1,"response","response-error"],[1,"badge","badge-error"],[1,"error-message"],[1,"response","response-timeout"],[1,"badge","badge-timeout"],[1,"timeout-message"],[1,"btn-secondary",3,"click"]],template:function(a,o){a&1&&(n(0,"div",0)(1,"h1"),t(2,"Request/Reply Pattern"),e(),n(3,"p"),t(4,"Synchronous communication with timeout management using Redis Streams"),e(),n(5,"div",1)(6,"div",2)(7,"div",3)(8,"h3",4),t(9,"\u{1F680} Send Request"),e()(),n(10,"div",5)(11,"p",6),t(12,"Stream: "),n(13,"code"),t(14,"order.holdInventory.v1"),e()(),n(15,"div",7)(16,"label"),t(17,"Order ID"),e(),n(18,"input",8),h("ngModelChange",function(M){return C(o.request.orderId,M)||(o.request.orderId=M),M}),e()(),n(19,"div",7)(20,"label"),t(21,"Items"),e(),n(22,"table")(23,"thead")(24,"tr")(25,"th"),t(26,"Item ID"),e(),n(27,"th"),t(28,"Description"),e(),n(29,"th"),t(30,"Quantity"),e(),O(31,"th"),e()(),n(32,"tbody"),x(33,N,10,3,"tr",9),e()(),n(34,"button",10),_("click",function(){return o.addItem()}),t(35,"+ Add Item"),e()(),n(36,"button",11),_("click",function(){return o.sendRequest()}),n(37,"span",12),t(38,"\u{1F680}"),e(),t(39),e(),x(40,K,5,1,"div",13),e()(),n(41,"div",2)(42,"div",14)(43,"div",15)(44,"h3",4),t(45,"\u{1F4E8} Response"),e(),n(46,"span",16),O(47,"span",17),t(48),e()()(),n(49,"div",5)(50,"p",6),t(51,"Stream: "),n(52,"code"),t(53,"order.holdInventory.response.v1"),e()(),x(54,L,2,0,"div",18)(55,B,23,3,"div",19)(56,j,25,3,"div",20)(57,Q,21,4,"div",21)(58,H,16,2,"div",22)(59,J,2,0,"button",23),e()()()()),a&2&&(r(18),b("ngModel",o.request.orderId),r(15),p("ngForOf",o.request.items),r(3),p("disabled",o.isSending||!o.request.orderId||o.request.items.length===0),r(3),g(" ",o.isSending?"Sending...":"Send Request"," "),r(),p("ngIf",o.response.correlationId),r(6),E("connected",o.isConnected())("disconnected",!o.isConnected()),r(2),g(" ",o.isConnected()?"WS Connected":"WS Disconnected"," "),r(6),p("ngIf",!o.response.type),r(),p("ngIf",o.response.type==="OK"),r(),p("ngIf",o.response.type==="KO"),r(),p("ngIf",o.response.type==="ERROR"),r(),p("ngIf",o.response.type==="TIMEOUT"),r(),p("ngIf",o.response.type))},dependencies:[w,R,k,F,D,V,W,A,z],styles:[".container[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:20px}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.page-title[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:#1e293b;margin:0 0 8px}.page-description[_ngcontent-%COMP%]{color:#64748b;margin:0}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:24px}.card[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background:#fff;border:1px solid #e2e8f0;border-radius:8px;overflow:hidden}.card-header[_ngcontent-%COMP%]{padding:16px;color:#fff}.request-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f093fb,#f5576c)}.response-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2)}.header-left[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.card-title[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin:0}.connection-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:12px;font-weight:500;padding:3px 8px;border-radius:10px;background:#ffffff26;width:fit-content}.connection-status.connected[_ngcontent-%COMP%]{background:#22c55e33}.connection-status.disconnected[_ngcontent-%COMP%]{background:#ef444433}.status-dot[_ngcontent-%COMP%]{width:6px;height:6px;border-radius:50%;background:#fff}.connection-status.connected[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:#22c55e;animation:_ngcontent-%COMP%_pulse 2s ease-in-out infinite}.connection-status.disconnected[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:#ef4444}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.card-content[_ngcontent-%COMP%]{flex:1;padding:16px;overflow-y:auto}.stream-info[_ngcontent-%COMP%]{font-size:14px;color:#64748b;margin-bottom:16px}.stream-info[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:#f1f5f9;padding:2px 6px;border-radius:4px;font-size:13px}.form-group[_ngcontent-%COMP%]{margin-bottom:16px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:600;margin-bottom:8px;color:#334155;font-size:14px}input[type=text][_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #cbd5e1;border-radius:6px;font-size:14px;transition:all .2s ease}input[type=text][_ngcontent-%COMP%]:focus, input[type=number][_ngcontent-%COMP%]:focus{outline:0;border-color:#667eea;box-shadow:0 0 0 3px #667eea1a}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:12px}table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:#f8fafc}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;font-size:13px;font-weight:600;color:#475569;border-bottom:2px solid #e2e8f0}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0}.btn-remove[_ngcontent-%COMP%]{padding:6px 10px;background:#fee2e2;color:#dc2626;border:1px solid #fca5a5;border-radius:6px;cursor:pointer;font-size:14px;font-weight:600;transition:all .2s ease}.btn-remove[_ngcontent-%COMP%]:hover:not(:disabled){background:#fecaca;transform:scale(1.1)}.btn-remove[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-add[_ngcontent-%COMP%]{background:#f1f5f9;color:#475569;border:1px solid #cbd5e1;padding:8px 12px;border-radius:6px;cursor:pointer;font-size:13px;font-weight:500;transition:all .2s ease}.btn-add[_ngcontent-%COMP%]:hover{background:#e2e8f0;border-color:#94a3b8}.btn-send[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;padding:14px 28px;border-radius:8px;cursor:pointer;font-size:15px;font-weight:600;width:100%;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 2px 8px #667eea4d}.btn-send[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px #667eea80}.btn-send[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0);box-shadow:0 2px 8px #667eea4d}.btn-send[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}.btn-icon[_ngcontent-%COMP%]{font-size:18px;display:inline-block;transition:transform .3s ease}.btn-send[_ngcontent-%COMP%]:hover:not(:disabled)   .btn-icon[_ngcontent-%COMP%]{transform:translate(3px)}.btn-secondary[_ngcontent-%COMP%]{background:#64748b;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:14px;margin-top:16px;width:100%;transition:all .2s ease}.btn-secondary[_ngcontent-%COMP%]:hover{background:#475569}.correlation-id[_ngcontent-%COMP%]{margin-top:16px;padding:12px;background:#f0f9ff;border:1px solid #bae6fd;border-radius:6px;font-size:13px}.correlation-id[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:#e0f2fe;padding:2px 6px;border-radius:4px;font-family:monospace}.no-response[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:40px 20px;color:#94a3b8;font-size:14px;font-style:italic}.response[_ngcontent-%COMP%]{padding:16px;border-radius:8px;margin-bottom:16px;animation:_ngcontent-%COMP%_fadeIn .3s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.response-ok[_ngcontent-%COMP%]{background:#f0fdf4;border:1px solid #bbf7d0}.response-ko[_ngcontent-%COMP%], .response-error[_ngcontent-%COMP%]{background:#fef2f2;border:1px solid #fecaca}.response-timeout[_ngcontent-%COMP%]{background:#fefce8;border:1px solid #fde047}.response-header[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:12px}.response[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;font-size:14px;color:#334155}.response[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#1e293b}.response[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:#0000000d;padding:2px 6px;border-radius:4px;font-family:monospace;font-size:12px}.badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600;margin-right:8px}.badge-ok[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.badge-ko[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.badge-error[_ngcontent-%COMP%]{background:#f97316;color:#fff}.badge-timeout[_ngcontent-%COMP%]{background:#eab308;color:#fff}.error-message[_ngcontent-%COMP%], .timeout-message[_ngcontent-%COMP%]{color:#64748b;font-style:italic;margin-top:8px}@media(max-width:768px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr}table[_ngcontent-%COMP%]{font-size:12px}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:6px}}"]})}}return s})();export{re as RequestReplyComponent};
