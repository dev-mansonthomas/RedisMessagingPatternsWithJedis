import{a as R,b as A,c as L,d as W,e as G,f as j,g as U,h as B}from"./chunk-IRGIIFUN.js";import{$a as V,Eb as z,Fb as D,Gb as y,Ja as _,Lb as E,M as I,Mb as N,Na as M,R as g,Ua as d,Va as n,W as m,Wa as i,X as p,Xa as u,ab as h,bb as c,fb as P,ga as x,gb as o,hb as C,ib as b,j as T,jb as q,kb as S,lb as v,mb as w,sb as F,wa as r}from"./chunk-ZMHPBY6C.js";var Q=(()=>{class a{constructor(){this.http=g(N),this.baseUrl="http://localhost:8080/api/dlq"}getStats(e,s,t){let l=new E().set("streamName",e).set("dlqStreamName",s).set("groupName",t);return this.http.get(`${this.baseUrl}/stats`,{params:l})}getMessages(e,s=10){let t=new E().set("streamName",e).set("count",s.toString());return this.http.get(`${this.baseUrl}/messages`,{params:t})}getPendingMessages(e,s,t=10){let l=new E().set("streamName",e).set("groupName",s).set("count",t.toString());return this.http.get(`${this.baseUrl}/pending-messages`,{params:l})}initializeGroup(e,s){let t=new E().set("streamName",e).set("groupName",s);return this.http.post(`${this.baseUrl}/init-group`,null,{params:t})}getNextMessage(e,s){let t=new E().set("streamName",e).set("groupName",s);return this.http.get(`${this.baseUrl}/next-message`,{params:t})}cleanup(e,s){let t=new E().set("streamName",e).set("dlqStreamName",s);return this.http.post(`${this.baseUrl}/cleanup`,null,{params:t})}static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275prov=I({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var $=(()=>{class a{constructor(){this.refreshSubject=new T,this.refresh$=this.refreshSubject.asObservable()}triggerRefresh(){console.log("StreamRefreshService: Triggering refresh for all streams"),this.refreshSubject.next()}static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275prov=I({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();function Z(a,f){if(a&1&&(n(0,"div",13),o(1),i()),a&2){let e=c();r(),b(" ... ",e.totalMessages-e.pageSize," more messages ... ")}}function ee(a,f){a&1&&(n(0,"span",20),o(1,"\u27A1\uFE0F"),i())}function te(a,f){if(a&1&&(n(0,"div",21)(1,"span",22),o(2),i(),n(3,"span",23),o(4),i()()),a&2){let e=f.$implicit;r(2),C(e.key),r(2),C(e.value)}}function ne(a,f){if(a&1&&(n(0,"div",14),M(1,ee,2,0,"span",15),n(2,"div",16)(3,"span",17),o(4),i()(),n(5,"div",18),M(6,te,5,2,"div",19),i()()),a&2){let e=f.$implicit,s=c();P("flash-error",e.isFlashingError)("flash-success",e.isFlashingSuccess)("next-to-process",e.isNextToProcess),r(),d("ngIf",s.showNextIndicator&&e.isNextToProcess),r(3),C(e.id),r(2),d("ngForOf",s.getFields(e.fields))}}function se(a,f){a&1&&(n(0,"div",24),o(1," No messages in stream "),i())}function ie(a,f){a&1&&(n(0,"div",25),o(1," Loading messages... "),i())}var H=(()=>{class a{constructor(){this.stream="",this.group="",this.consumer="",this.pageSize=10,this.showNextIndicator=!1,this.wsService=g(R),this.apiService=g(Q),this.refreshService=g($),this.cdr=g(F),this.displayedMessages=[],this.totalMessages=0,this.hasMoreMessages=!1,this.isConnected=!1,this.isLoading=!0}ngOnInit(){this.stream&&this.group&&this.consumer?(this.loadInitialData(),this.connectWebSocket(),this.subscribeToRefresh()):(console.warn("StreamViewerComponent: Missing required parameters (stream, group, consumer)"),this.isLoading=!1)}ngOnDestroy(){this.eventSubscription?.unsubscribe(),this.statusSubscription?.unsubscribe(),this.refreshSubscription?.unsubscribe()}subscribeToRefresh(){this.refreshSubscription=this.refreshService.refresh$.subscribe(()=>{console.log(`StreamViewer [${this.stream}]: Received refresh event, reloading data`),this.loadInitialData()})}loadInitialData(){this.isLoading=!0,console.log(`StreamViewer [${this.stream}]: Loading initial data (pageSize: ${this.pageSize})`),this.apiService.getMessages(this.stream,this.pageSize).subscribe({next:e=>{console.log(`StreamViewer [${this.stream}]: Received response:`,e),e.success&&e.messages?(this.displayedMessages=e.messages.map(s=>({id:s.id,fields:s.fields,timestamp:new Date().toISOString()})),this.totalMessages=e.count,this.hasMoreMessages=!1,console.log(`StreamViewer [${this.stream}]: Loaded ${this.displayedMessages.length} messages`,this.displayedMessages),this.updateNextIndicator()):console.warn(`StreamViewer [${this.stream}]: Response not successful or no messages`,e),this.isLoading=!1,this.cdr.detectChanges()},error:e=>{console.error(`StreamViewer [${this.stream}]: Failed to load messages`,e),console.error(`StreamViewer [${this.stream}]: Error details:`,{status:e.status,statusText:e.statusText,message:e.message,url:e.url}),this.isLoading=!1}})}connectWebSocket(){this.wsService.connect(),this.statusSubscription=this.wsService.getConnectionStatus().subscribe(e=>{console.log(`StreamViewer [${this.stream}]: Connection status changed to ${e}`),this.isConnected=e,this.cdr.detectChanges()}),this.eventSubscription=this.wsService.getEvents().subscribe(e=>this.handleWebSocketEvent(e)),this.wsService.isConnected()&&(this.isConnected=!0)}handleWebSocketEvent(e){if(console.log(`StreamViewer [${this.stream}]: Received WebSocket event:`,e),e.streamName!==this.stream){console.log(`StreamViewer [${this.stream}]: Event ignored (different stream: ${e.streamName})`);return}if(e.eventType==="MESSAGE_PROCESSED"&&e.messageId&&(console.log(`StreamViewer [${this.stream}]: \u2705 MESSAGE_PROCESSED received!`),this.flashMessageSuccess(e.messageId),this.moveIndicatorToNextMessage(e.messageId)),e.eventType==="MESSAGE_DELETED"&&e.messageId){console.log(`StreamViewer [${this.stream}]: MESSAGE_DELETED received for:`,e.messageId);let s=this.displayedMessages.find(l=>l.id===e.messageId);if(s&&s.isFlashingSuccess){console.log(`StreamViewer [${this.stream}]: Message is flashing, marking for deletion after animation`),s.pendingDeletion=!0;return}console.log(`StreamViewer [${this.stream}]: Deleting message immediately:`,e.messageId);let t=this.displayedMessages.length;this.displayedMessages=this.displayedMessages.filter(l=>l.id!==e.messageId),this.displayedMessages.length<t&&(this.totalMessages--,console.log(`StreamViewer [${this.stream}]: Message deleted. New count: ${this.totalMessages}`)),this.updateNextIndicator(),this.cdr.detectChanges();return}if(e.eventType==="MESSAGE_RECLAIMED"&&e.messageId){console.log(`StreamViewer [${this.stream}]: \u26A0\uFE0F MESSAGE_RECLAIMED received!`),this.flashMessage(e.messageId),this.moveIndicatorToNextMessage(e.messageId);return}if(e.eventType==="INFO"||e.eventType==="ERROR"){console.log(`StreamViewer [${this.stream}]: Event ignored (processing event: ${e.eventType})`);return}if(e.eventType==="MESSAGE_PRODUCED"&&e.messageId&&e.payload){let s={id:e.messageId,fields:e.payload,timestamp:e.timestamp||new Date().toISOString()};console.log(`StreamViewer [${this.stream}]: Adding new message:`,s),this.displayedMessages.unshift(s),this.totalMessages++,this.displayedMessages.length>this.pageSize&&(this.displayedMessages=this.displayedMessages.slice(0,this.pageSize),this.hasMoreMessages=!0),this.updateNextIndicator(),this.cdr.detectChanges()}}getFields(e){return Object.entries(e).map(([s,t])=>({key:s,value:t}))}updateNextIndicator(){if(!this.showNextIndicator||this.displayedMessages.length===0){console.log(`StreamViewer [${this.stream}]: updateNextIndicator skipped (showNextIndicator=${this.showNextIndicator}, messages=${this.displayedMessages.length})`);return}console.log(`StreamViewer [${this.stream}]: updateNextIndicator called, clearing all indicators`),this.displayedMessages.forEach(e=>e.isNextToProcess=!1),console.log(`StreamViewer [${this.stream}]: Fetching next pending message from Redis...`),this.apiService.getNextMessage(this.stream,this.group).subscribe({next:e=>{if(console.log(`StreamViewer [${this.stream}]: getNextMessage response:`,e),e.success&&e.nextMessageId){console.log(`StreamViewer [${this.stream}]: Next pending message from Redis: ${e.nextMessageId}`),console.log(`StreamViewer [${this.stream}]: Current displayed messages:`,this.displayedMessages.map(t=>t.id));let s=this.displayedMessages.find(t=>t.id===e.nextMessageId);s?(s.isNextToProcess=!0,console.log(`StreamViewer [${this.stream}]: \u2705 Marked message ${e.nextMessageId} as next to process`),this.cdr.detectChanges()):(console.warn(`StreamViewer [${this.stream}]: \u274C Next message ${e.nextMessageId} not found in displayed messages`),console.warn(`StreamViewer [${this.stream}]: Available message IDs:`,this.displayedMessages.map(t=>t.id)))}else console.log(`StreamViewer [${this.stream}]: No pending messages (nextMessageId=${e.nextMessageId})`)},error:e=>{console.error(`StreamViewer [${this.stream}]: Error fetching next message:`,e)}})}moveIndicatorToNextMessage(e){console.log(`StreamViewer [${this.stream}]: Putting indicator on message ${e}`),this.displayedMessages.forEach(t=>t.isNextToProcess=!1);let s=this.displayedMessages.find(t=>t.id===e);if(!s){console.warn(`StreamViewer [${this.stream}]: Message ${e} not found`);return}s.isNextToProcess=!0,console.log(`StreamViewer [${this.stream}]: \u2705 Put indicator on message ${e}`),this.cdr.detectChanges()}testFlash(){if(this.displayedMessages.length>0){let e=this.displayedMessages[0].id;console.log(`\u{1F9EA} Testing flash on first message: ${e}`),this.flashMessage(e)}else console.warn("No messages to flash")}flashMessage(e){console.log(`StreamViewer [${this.stream}]: Flashing message RED ${e}`),console.log(`StreamViewer [${this.stream}]: Current displayed messages:`,this.displayedMessages.map(t=>t.id));let s=this.displayedMessages.find(t=>t.id===e);s?(console.log(`StreamViewer [${this.stream}]: Message found! Setting isFlashingError=true`),s.isFlashingError=!0,this.cdr.detectChanges(),setTimeout(()=>{console.log(`StreamViewer [${this.stream}]: Removing red flash from message ${e}`),s.isFlashingError=!1,this.cdr.detectChanges()},2e3)):(console.warn(`StreamViewer [${this.stream}]: Message ${e} not found for flashing`),console.warn(`StreamViewer [${this.stream}]: Available message IDs:`,this.displayedMessages.map(t=>t.id)))}flashMessageSuccess(e){console.log(`StreamViewer [${this.stream}]: Flashing message GREEN ${e}`),console.log(`StreamViewer [${this.stream}]: Current displayed messages:`,this.displayedMessages.map(t=>t.id));let s=this.displayedMessages.find(t=>t.id===e);s?(console.log(`StreamViewer [${this.stream}]: Message found! Setting isFlashingSuccess=true`),s.isFlashingSuccess=!0,this.cdr.detectChanges(),setTimeout(()=>{if(console.log(`StreamViewer [${this.stream}]: Animation complete for message ${e}`),s.isFlashingSuccess=!1,s.pendingDeletion){console.log(`StreamViewer [${this.stream}]: Deleting message after animation: ${e}`);let t=this.displayedMessages.length;this.displayedMessages=this.displayedMessages.filter(l=>l.id!==e),this.displayedMessages.length<t&&(this.totalMessages--,console.log(`StreamViewer [${this.stream}]: Message deleted after animation. New count: ${this.totalMessages}`)),this.updateNextIndicator()}this.cdr.detectChanges()},2e3)):(console.warn(`StreamViewer [${this.stream}]: Message ${e} not found for flashing`),console.warn(`StreamViewer [${this.stream}]: Available message IDs:`,this.displayedMessages.map(t=>t.id)))}static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275cmp=_({type:a,selectors:[["app-stream-viewer"]],inputs:{stream:"stream",group:"group",consumer:"consumer",pageSize:"pageSize",showNextIndicator:"showNextIndicator"},decls:16,vars:12,consts:[[1,"stream-viewer"],[1,"stream-header"],[1,"stream-name"],[1,"connection-status"],[1,"status-dot"],[1,"status-text"],[1,"messages-container"],["class","more-messages",4,"ngIf"],["class","message-cell",3,"flash-error","flash-success","next-to-process",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","loading-state",4,"ngIf"],[1,"stream-footer"],[1,"message-count"],[1,"more-messages"],[1,"message-cell"],["class","next-indicator",4,"ngIf"],[1,"message-header"],[1,"message-id"],[1,"message-content"],["class","field-row",4,"ngFor","ngForOf"],[1,"next-indicator"],[1,"field-row"],[1,"field-key"],[1,"field-value"],[1,"empty-state"],[1,"loading-state"]],template:function(s,t){s&1&&(n(0,"div",0)(1,"div",1)(2,"h3",2),o(3),i(),n(4,"div",3),u(5,"span",4),n(6,"span",5),o(7),i()()(),n(8,"div",6),M(9,Z,2,1,"div",7)(10,ne,7,9,"div",8)(11,se,2,0,"div",9)(12,ie,2,0,"div",10),i(),n(13,"div",11)(14,"span",12),o(15),i()()()),s&2&&(r(3),C(t.stream),r(),P("connected",t.isConnected)("disconnected",!t.isConnected),r(3),C(t.isConnected?"Connected":"Disconnected"),r(2),d("ngIf",t.hasMoreMessages),r(),d("ngForOf",t.displayedMessages),r(),d("ngIf",t.displayedMessages.length===0&&!t.isLoading),r(),d("ngIf",t.isLoading),r(3),q("",t.displayedMessages.length," of ",t.totalMessages," messages"))},dependencies:[y,z,D],styles:['@charset "UTF-8";.stream-viewer[_ngcontent-%COMP%]{background:#fff;border-radius:8px;border:1px solid #e2e8f0;overflow:hidden;display:flex;flex-direction:column;height:100%}.stream-header[_ngcontent-%COMP%]{padding:12px 16px;background:linear-gradient(135deg,#f8fafc,#f1f5f9);border-bottom:1px solid #e2e8f0;display:flex;flex-shrink:0;justify-content:space-between;align-items:center}.stream-name[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:600;color:#1e293b}.connection-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:11px;padding:3px 8px;border-radius:10px;background:#f1f5f9}.connection-status.connected[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.connection-status.disconnected[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.status-dot[_ngcontent-%COMP%]{width:5px;height:5px;border-radius:50%;background:currentColor}.status-text[_ngcontent-%COMP%]{font-weight:500}.messages-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:2px;padding:8px 8px 8px 36px;background:#f8fafc}.more-messages[_ngcontent-%COMP%]{text-align:center;padding:8px;font-size:12px;color:#64748b;font-style:italic;background:#f1f5f9;border-radius:4px}.message-cell[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:4px;overflow:hidden;transition:box-shadow .15s ease;position:relative}.message-cell[_ngcontent-%COMP%]:hover{box-shadow:0 1px 3px #0000001a}.message-cell.next-to-process[_ngcontent-%COMP%]{border-left:3px solid #3b82f6}.next-indicator[_ngcontent-%COMP%]{position:absolute;left:-28px;top:50%;transform:translateY(-50%);font-size:20px;animation:_ngcontent-%COMP%_pulse 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.message-cell.flash-error[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_flashRed .5s ease-in-out 4}@keyframes _ngcontent-%COMP%_flashRed{0%,to{background:#fff;border-color:#e2e8f0;transform:scale(1)}50%{background:#dc2626;border-color:#dc2626;color:#fff;box-shadow:0 0 20px #dc2626cc;transform:scale(1.02)}}.message-cell.flash-error[_ngcontent-%COMP%]   .message-id[_ngcontent-%COMP%], .message-cell.flash-error[_ngcontent-%COMP%]   .field-key[_ngcontent-%COMP%], .message-cell.flash-error[_ngcontent-%COMP%]   .field-value[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_textFlashRed .5s ease-in-out 4}@keyframes _ngcontent-%COMP%_textFlashRed{0%,to{color:inherit}50%{color:#fff}}.message-cell.flash-success[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_flashGreen .5s ease-in-out 4}@keyframes _ngcontent-%COMP%_flashGreen{0%,to{background:#fff;border-color:#e2e8f0;transform:scale(1)}50%{background:#16a34a;border-color:#16a34a;color:#fff;box-shadow:0 0 20px #16a34acc;transform:scale(1.02)}}.message-cell.flash-success[_ngcontent-%COMP%]   .message-id[_ngcontent-%COMP%], .message-cell.flash-success[_ngcontent-%COMP%]   .field-key[_ngcontent-%COMP%], .message-cell.flash-success[_ngcontent-%COMP%]   .field-value[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_textFlashGreen .5s ease-in-out 4}@keyframes _ngcontent-%COMP%_textFlashGreen{0%,to{color:inherit}50%{color:#fff}}.message-header[_ngcontent-%COMP%]{background:#f8fafc;padding:6px 10px;border-bottom:1px solid #e2e8f0}.message-id[_ngcontent-%COMP%]{font-family:Courier New,monospace;font-size:10px;color:#64748b;font-weight:500}.message-content[_ngcontent-%COMP%]{padding:8px 10px;font-size:12px;display:flex;flex-direction:column;gap:4px}.field-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:100px 1fr;gap:12px;align-items:baseline}.field-key[_ngcontent-%COMP%]{font-weight:600;color:#64748b;font-size:11px;text-align:right;padding-right:8px;border-right:2px solid #e2e8f0}.field-value[_ngcontent-%COMP%]{color:#1e293b;font-weight:500;font-size:12px;word-break:break-word}.empty-state[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]{text-align:center;color:#94a3b8;font-size:13px;padding:40px 20px;font-style:italic}.stream-footer[_ngcontent-%COMP%]{padding:8px 12px;background:#f8fafc;border-top:1px solid #e2e8f0;display:flex;justify-content:center;align-items:center;flex-shrink:0}.message-count[_ngcontent-%COMP%]{font-size:11px;color:#64748b;font-weight:500}']})}}return a})();function oe(a,f){if(a&1){let e=V();n(0,"div",3),h("click",function(){m(e);let t=c();return p(t.toggleExpand())}),n(1,"div",4)(2,"span",5),o(3,"Max Deliveries:"),i(),n(4,"span",6),o(5),i()(),n(6,"div",7),o(7,"\u25BC"),i()()}if(a&2){let e=c();r(5),C(e.config.maxDeliveries)}}function ae(a,f){if(a&1&&(n(0,"div",36),o(1),i()),a&2){let e=c(2);P("success",e.isSuccess())("error",!e.isSuccess()),r(),b(" ",e.message()," ")}}function re(a,f){if(a&1){let e=V();n(0,"div",8)(1,"div",9),h("click",function(){m(e);let t=c();return p(t.toggleExpand())}),n(2,"h3",10),o(3,"DLQ Configuration"),i(),n(4,"div",11),o(5,"\u25B2"),i()(),n(6,"div",12)(7,"h4",13),o(8,"Stream Configuration (Read-only)"),i(),n(9,"div",14)(10,"label",15),o(11,"Main Stream Name"),i(),n(12,"input",16),w("ngModelChange",function(t){m(e);let l=c();return v(l.config.streamName,t)||(l.config.streamName=t),p(t)}),i()(),n(13,"div",14)(14,"label",17),o(15,"DLQ Stream Name"),i(),n(16,"input",18),w("ngModelChange",function(t){m(e);let l=c();return v(l.config.dlqStreamName,t)||(l.config.dlqStreamName=t),p(t)}),i()(),n(17,"div",14)(18,"label",19),o(19,"Consumer Group"),i(),n(20,"input",20),w("ngModelChange",function(t){m(e);let l=c();return v(l.config.consumerGroup,t)||(l.config.consumerGroup=t),p(t)}),i()(),n(21,"div",14)(22,"label",21),o(23,"Consumer Name"),i(),n(24,"input",22),w("ngModelChange",function(t){m(e);let l=c();return v(l.config.consumerName,t)||(l.config.consumerName=t),p(t)}),i()()(),n(25,"div",12)(26,"h4",13),o(27,"DLQ Parameters"),i(),n(28,"div",23)(29,"label",24),o(30," Max Retry (Max Deliveries) - Editable "),n(31,"span",25),o(32,"Messages will be sent to DLQ after this many delivery attempts"),i()(),n(33,"input",26),w("ngModelChange",function(t){m(e);let l=c();return v(l.config.maxDeliveries,t)||(l.config.maxDeliveries=t),p(t)}),i(),n(34,"div",27),o(35),i()(),n(36,"div",14)(37,"label",28),o(38," Min Idle Time (ms) "),n(39,"span",25),o(40,"Minimum time a message must be idle before reclaim"),i()(),n(41,"input",29),w("ngModelChange",function(t){m(e);let l=c();return v(l.config.minIdleMs,t)||(l.config.minIdleMs=t),p(t)}),i(),n(42,"div",27),o(43),i()(),n(44,"div",14)(45,"label",30),o(46," Batch Size "),n(47,"span",25),o(48,"Max messages to process per claim operation"),i()(),n(49,"input",31),w("ngModelChange",function(t){m(e);let l=c();return v(l.config.count,t)||(l.config.count=t),p(t)}),i()()(),n(50,"div",32)(51,"button",33),h("click",function(){m(e);let t=c();return p(t.saveConfig())}),o(52),i(),n(53,"button",34),h("click",function(){m(e);let t=c();return p(t.resetMaxRetry())}),o(54," Reset Max Retry "),i()(),M(55,ae,2,5,"div",35),i()}if(a&2){let e=c();r(12),S("ngModel",e.config.streamName),r(4),S("ngModel",e.config.dlqStreamName),r(4),S("ngModel",e.config.consumerGroup),r(4),S("ngModel",e.config.consumerName),r(9),S("ngModel",e.config.maxDeliveries),r(2),b("Current value: ",e.config.maxDeliveries," attempts"),r(6),S("ngModel",e.config.minIdleMs),r(2),b("",e.config.minIdleMs/1e3," seconds"),r(6),S("ngModel",e.config.count),r(2),d("disabled",e.isSaving()),r(),b(" ",e.isSaving()?"Saving...":"Save Max Retry"," "),r(3),d("ngIf",e.message())}}var J=(()=>{class a{constructor(){this.http=g(N),this.apiUrl="http://localhost:8080/api/dlq",this.config={streamName:"test-stream",dlqStreamName:"test-stream:dlq",consumerGroup:"test-group",consumerName:"consumer-1",minIdleMs:100,count:100,maxDeliveries:2},this.isSaving=x(!1),this.message=x(""),this.isSuccess=x(!1),this.isExpanded=x(!1)}toggleExpand(){this.isExpanded.set(!this.isExpanded())}saveConfig(){this.isSaving.set(!0),this.message.set(""),this.http.post(`${this.apiUrl}/config`,this.config).subscribe({next:()=>{this.isSaving.set(!1),this.isSuccess.set(!0),this.message.set("Max Retry saved successfully! Set to "+this.config.maxDeliveries+" attempts"),setTimeout(()=>this.message.set(""),5e3)},error:e=>{this.isSaving.set(!1),this.isSuccess.set(!1),this.message.set("Failed to save: "+(e.error?.message||e.message)),console.error("Error saving config:",e)}})}resetMaxRetry(){this.config.maxDeliveries=2,this.message.set("Max Retry reset to default (2 attempts)"),this.isSuccess.set(!0),setTimeout(()=>this.message.set(""),3e3)}static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275cmp=_({type:a,selectors:[["app-dlq-config"]],decls:3,vars:2,consts:[[1,"dlq-config"],["class","collapsed-view",3,"click",4,"ngIf"],["class","expanded-view",4,"ngIf"],[1,"collapsed-view",3,"click"],[1,"collapsed-content"],[1,"collapsed-label"],[1,"collapsed-value"],[1,"expand-icon"],[1,"expanded-view"],[1,"header-row",3,"click"],[1,"section-title"],[1,"collapse-icon"],[1,"config-section"],[1,"subsection-title"],[1,"form-group"],["for","streamName"],["id","streamName","type","text","placeholder","test-stream","readonly","",1,"form-input",3,"ngModelChange","ngModel"],["for","dlqStreamName"],["id","dlqStreamName","type","text","placeholder","test-stream:dlq","readonly","",1,"form-input",3,"ngModelChange","ngModel"],["for","consumerGroup"],["id","consumerGroup","type","text","placeholder","test-group","readonly","",1,"form-input",3,"ngModelChange","ngModel"],["for","consumerName"],["id","consumerName","type","text","placeholder","consumer-1","readonly","",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-group","highlight"],["for","maxDeliveries"],[1,"label-hint"],["id","maxDeliveries","type","number","min","1","max","100",1,"form-input","editable",3,"ngModelChange","ngModel"],[1,"input-hint"],["for","minIdleMs"],["id","minIdleMs","type","number","min","0","step","1000","readonly","",1,"form-input",3,"ngModelChange","ngModel"],["for","count"],["id","count","type","number","min","1","max","1000","readonly","",1,"form-input",3,"ngModelChange","ngModel"],[1,"actions"],[1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-secondary",3,"click"],["class","message",3,"success","error",4,"ngIf"],[1,"message"]],template:function(s,t){s&1&&(n(0,"div",0),M(1,oe,8,1,"div",1)(2,re,56,12,"div",2),i()),s&2&&(r(),d("ngIf",!t.isExpanded()),r(),d("ngIf",t.isExpanded()))},dependencies:[y,D,B,A,G,L,U,j,W],styles:[".dlq-config[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.collapsed-view[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px;cursor:pointer;transition:all .2s ease}.collapsed-view[_ngcontent-%COMP%]:hover{background:#f1f5f9;border-color:#cbd5e1;box-shadow:0 1px 3px #0000001a}.collapsed-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.collapsed-label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#475569}.collapsed-value[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#3b82f6;min-width:24px;text-align:center}.expand-icon[_ngcontent-%COMP%], .collapse-icon[_ngcontent-%COMP%]{font-size:12px;color:#64748b;transition:transform .2s ease}.expanded-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.header-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;cursor:pointer;padding:8px 0;border-bottom:2px solid #e2e8f0}.header-row[_ngcontent-%COMP%]:hover   .section-title[_ngcontent-%COMP%]{color:#3b82f6}.config-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.section-title[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#1e293b;margin:0;transition:color .2s ease}.subsection-title[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#475569;margin:0 0 8px;text-transform:uppercase;letter-spacing:.5px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.form-group.highlight[_ngcontent-%COMP%]{background:#eff6ff;padding:12px;border-radius:8px;border:2px solid #3b82f6}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#334155;display:flex;flex-direction:column;gap:2px}.label-hint[_ngcontent-%COMP%]{font-size:12px;font-weight:400;color:#64748b;font-style:italic}.form-input[_ngcontent-%COMP%]{padding:10px 12px;border:1px solid #cbd5e1;border-radius:6px;font-size:14px;transition:all .2s ease;background:#f8fafc}.form-input[readonly][_ngcontent-%COMP%]{background:#f1f5f9;color:#64748b;cursor:not-allowed;border-color:#e2e8f0}.form-input.editable[_ngcontent-%COMP%]{background:#fff;border-color:#3b82f6;font-weight:600}.form-input.editable[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px #3b82f633}.form-input[_ngcontent-%COMP%]:disabled{background:#f1f5f9;cursor:not-allowed}.input-hint[_ngcontent-%COMP%]{font-size:12px;color:#64748b;margin-top:-2px}.actions[_ngcontent-%COMP%]{display:flex;gap:12px;padding-top:8px}.btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb;box-shadow:0 2px 4px #3b82f64d}.btn-secondary[_ngcontent-%COMP%]{background:#e2e8f0;color:#334155}.btn-secondary[_ngcontent-%COMP%]:hover{background:#cbd5e1}.message[_ngcontent-%COMP%]{padding:12px 16px;border-radius:6px;font-size:14px;font-weight:500}.message.success[_ngcontent-%COMP%]{background:#dcfce7;color:#166534;border:1px solid #86efac}.message.error[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b;border:1px solid #fca5a5}"]})}}return a})();function le(a,f){if(a&1&&(n(0,"div",12),o(1),i()),a&2){let e=c();P("error",e.isError()),r(),b(" ",e.statusMessage()," ")}}var K=(()=>{class a{constructor(){this.http=g(N),this.refreshService=g($),this.apiUrl="http://localhost:8080/api/dlq",this.isProcessing=x(!1),this.statusMessage=x(""),this.isError=x(!1)}generateMessages(){this.isProcessing.set(!0),this.statusMessage.set("Generating messages..."),this.isError.set(!1);let e=this.createRandomMessages(4),s=0,t=0;e.forEach((l,O)=>{setTimeout(()=>{this.http.post(`${this.apiUrl}/produce`,{streamName:"test-stream",payload:l}).subscribe({next:()=>{s++,s+t===e.length&&(this.isProcessing.set(!1),t===0?(this.statusMessage.set(`\u2713 Generated ${s} messages successfully`),this.isError.set(!1)):(this.statusMessage.set(`\u26A0 Generated ${s}/${e.length} messages (${t} failed)`),this.isError.set(!0)),setTimeout(()=>this.statusMessage.set(""),3e3))},error:()=>{t++,s+t===e.length&&(this.isProcessing.set(!1),this.statusMessage.set(`\u26A0 Generated ${s}/${e.length} messages (${t} failed)`),this.isError.set(!0),setTimeout(()=>this.statusMessage.set(""),3e3))}})},O*100)})}createRandomMessages(e){let s=[],t=["payment_failed","out_of_stock","customer_request","fraud_detected"];for(let l=0;l<e;l++){let O=1e3+Math.floor(Math.random()*9e3);if(Math.random()>.8)s.push({type:"order.cancelled",order_id:O.toString(),reason:t[Math.floor(Math.random()*t.length)]});else{let Y=(Math.random()*100+10).toFixed(2);s.push({type:"order.created",order_id:O.toString(),amount:Y})}}return s}clearAllStreams(){if(!confirm("Are you sure you want to delete all streams (test-stream and test-stream:dlq)? This action cannot be undone."))return;this.isProcessing.set(!0),this.statusMessage.set("Clearing streams..."),this.isError.set(!1);let e=["test-stream","test-stream:dlq"],s=0,t=0;e.forEach(l=>{this.http.delete(`${this.apiUrl}/stream/${l}`).subscribe({next:O=>{s++,s+t===e.length&&(this.isProcessing.set(!1),t===0?(this.statusMessage.set(`\u2713 Cleared ${s} streams successfully`),this.isError.set(!1)):(this.statusMessage.set(`\u26A0 Cleared ${s}/${e.length} streams (${t} failed)`),this.isError.set(!0)),this.refreshService.triggerRefresh(),setTimeout(()=>this.statusMessage.set(""),3e3))},error:O=>{t++,s+t===e.length&&(this.isProcessing.set(!1),s>0?this.statusMessage.set(`\u26A0 Cleared ${s}/${e.length} streams (${t} failed)`):this.statusMessage.set("Error: Failed to clear streams"),this.isError.set(!0),s>0&&this.refreshService.triggerRefresh(),setTimeout(()=>this.statusMessage.set(""),3e3))}})})}processWithSuccess(){this.processMessage(!0)}processWithFail(){this.processMessage(!1)}processMessage(e){this.isProcessing.set(!0),this.statusMessage.set("Processing..."),this.isError.set(!1),this.http.post(`${this.apiUrl}/process`,{shouldSucceed:e}).subscribe({next:s=>{s.success?(this.statusMessage.set(s.message||"Message processed successfully"),this.isError.set(!1)):(this.statusMessage.set(s.message||"No messages to process"),this.isError.set(!0)),this.isProcessing.set(!1),setTimeout(()=>this.statusMessage.set(""),3e3)},error:s=>{this.statusMessage.set("Error: "+(s.error?.message||"Failed to process message")),this.isError.set(!0),this.isProcessing.set(!1),setTimeout(()=>this.statusMessage.set(""),3e3)}})}static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275cmp=_({type:a,selectors:[["app-dlq-actions"]],decls:28,vars:5,consts:[[1,"dlq-actions"],[1,"actions-header"],[1,"actions-title"],[1,"actions-content"],[1,"action-button","generate",3,"click","disabled"],[1,"button-icon"],[1,"button-text"],[1,"separator"],[1,"action-button","success",3,"click","disabled"],[1,"action-button","fail",3,"click","disabled"],[1,"action-button","clear",3,"click","disabled"],["class","status-message",3,"error",4,"ngIf"],[1,"status-message"]],template:function(s,t){s&1&&(n(0,"div",0)(1,"div",1)(2,"h3",2),o(3,"Message Processing"),i()(),n(4,"div",3)(5,"button",4),h("click",function(){return t.generateMessages()}),n(6,"span",5),o(7,"\u26A1"),i(),n(8,"span",6),o(9,"Generate Messages"),i()(),u(10,"div",7),n(11,"button",8),h("click",function(){return t.processWithSuccess()}),n(12,"span",5),o(13,"\u2713"),i(),n(14,"span",6),o(15,"Process & Success"),i()(),n(16,"button",9),h("click",function(){return t.processWithFail()}),n(17,"span",5),o(18,"\u2717"),i(),n(19,"span",6),o(20,"Process & Fail"),i()(),u(21,"div",7),n(22,"button",10),h("click",function(){return t.clearAllStreams()}),n(23,"span",5),o(24,"\u{1F5D1}\uFE0F"),i(),n(25,"span",6),o(26,"Clear All Streams"),i()(),M(27,le,2,3,"div",11),i()()),s&2&&(r(5),d("disabled",t.isProcessing()),r(6),d("disabled",t.isProcessing()),r(5),d("disabled",t.isProcessing()),r(6),d("disabled",t.isProcessing()),r(5),d("ngIf",t.statusMessage()))},dependencies:[y,D],styles:[".dlq-actions[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;border:1px solid #e2e8f0;overflow:hidden;display:flex;flex-direction:column;height:100%}.actions-header[_ngcontent-%COMP%]{padding:12px 16px;border-bottom:1px solid #e2e8f0;background:linear-gradient(135deg,#f8fafc,#f1f5f9)}.actions-title[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#1e293b;margin:0}.actions-content[_ngcontent-%COMP%]{padding:16px;display:flex;flex-direction:column;gap:12px;flex:1}.action-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;padding:12px 16px;border:none;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s ease;box-shadow:0 1px 2px #0000000d}.action-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 6px #0000001a}.action-button[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0)}.action-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.action-button.success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);color:#fff}.action-button.success[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#059669,#047857)}.action-button.fail[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff}.action-button.fail[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#dc2626,#b91c1c)}.action-button.generate[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff}.action-button.generate[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#2563eb,#1d4ed8)}.action-button.clear[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}.action-button.clear[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#d97706,#b45309)}.separator[_ngcontent-%COMP%]{height:1px;background:#e2e8f0;margin:8px 0}.button-icon[_ngcontent-%COMP%]{font-size:18px;font-weight:700}.button-text[_ngcontent-%COMP%]{font-size:14px}.status-message[_ngcontent-%COMP%]{padding:12px;border-radius:6px;font-size:13px;background:#f0fdf4;color:#166534;border:1px solid #bbf7d0;text-align:center}.status-message.error[_ngcontent-%COMP%]{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}"]})}}return a})();var Le=(()=>{class a{static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275cmp=_({type:a,selectors:[["app-dlq"]],decls:125,vars:3,consts:[[1,"dlq-container"],[1,"page-header"],[1,"page-title"],[1,"page-description"],[1,"content-layout"],[1,"config-section"],[1,"streams-section"],[1,"stream-column"],["stream","test-stream","group","test-group","consumer","consumer-1",3,"pageSize","showNextIndicator"],[1,"actions-column"],["stream","test-stream:dlq","group","dlq-group","consumer","dlq-consumer",3,"pageSize"],[1,"explanation-section"],[1,"explanation-title"],[1,"xadd-example"],[1,"xadd-line"],[1,"xadd-command"],[1,"xadd-stream"],[1,"xadd-id"],[1,"xadd-field"],[1,"xadd-value"],[1,"pseudocode"],[1,"code-block"],[1,"code-line"],[1,"keyword"],[1,"function"],[1,"comment"],[1,"code-line","indent1"],[1,"code-line","indent2"],[1,"success"],[1,"error"]],template:function(s,t){s&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),o(3,"Dead Letter Queue (DLQ)"),i(),n(4,"p",3),o(5," Demonstrate Redis DLQ messaging patterns with real-time monitoring and testing capabilities. "),i()(),n(6,"div",4)(7,"div",5),u(8,"app-dlq-config"),i(),n(9,"div",6)(10,"div",7),u(11,"app-stream-viewer",8),i(),n(12,"div",9),u(13,"app-dlq-actions"),i(),n(14,"div",7),u(15,"app-stream-viewer",10),i()(),n(16,"div",11)(17,"h3",12),o(18,"\u{1F504} DLQ Pattern Logic"),i(),n(19,"div",13)(20,"div",14)(21,"span",15),o(22,"XADD"),i(),n(23,"span",16),o(24,"test-stream"),i(),n(25,"span",17),o(26,"*"),i(),n(27,"span",18),o(28,"type"),i(),n(29,"span",19),o(30,"order.created"),i(),n(31,"span",18),o(32,"order_id"),i(),n(33,"span",19),o(34,"12345"),i(),n(35,"span",18),o(36,"amount"),i(),n(37,"span",19),o(38,"99.99"),i()()(),n(39,"div",20)(40,"div",21)(41,"div",22)(42,"span",23),o(43,"function"),i(),n(44,"span",24),o(45," getNextMessages"),i(),o(46,"() "),n(47,"span",25),o(48,"// Java"),i(),o(49,":"),i(),n(50,"div",26),o(51,"messages = "),n(52,"span",24),o(53,"read_claim_or_dlq"),i(),o(54,"() "),n(55,"span",25),o(56,"// Lua script"),i()(),n(57,"div",26)(58,"span",23),o(59,"return"),i(),o(60," messages"),i(),u(61,"div",22),n(62,"div",22)(63,"span",25),o(64,"// Lua: read_claim_or_dlq()"),i()(),n(65,"div",26)(66,"span",25),o(67,"// 1. XPENDING \u2192 find idle messages"),i()(),n(68,"div",26)(69,"span",25),o(70,"// 2. If deliveries >= max:"),i()(),n(71,"div",27)(72,"span",25),o(73,"// XCLAIM + XADD(dlq) + XACK"),i()(),n(74,"div",26)(75,"span",25),o(76,"// 3. XREADGROUP CLAIM \u2192 get pending + new"),i()()(),n(77,"div",21)(78,"div",22)(79,"span",23),o(80,"function"),i(),n(81,"span",28),o(82," processSuccess"),i(),o(83,"() "),n(84,"span",25),o(85,"// Java"),i(),o(86,":"),i(),n(87,"div",26),o(88,"msg = "),n(89,"span",24),o(90,"getNextMessages"),i(),o(91,"()"),i(),n(92,"div",26)(93,"span",25),o(94,"// \u{1F4BC} Process business logic"),i()(),n(95,"div",26)(96,"span",24),o(97,"XACK"),i(),o(98,"(msg) "),n(99,"span",25),o(100,"// \u2705 Remove from PENDING"),i()()(),n(101,"div",21)(102,"div",22)(103,"span",23),o(104,"function"),i(),n(105,"span",29),o(106," processFail"),i(),o(107,"() "),n(108,"span",25),o(109,"// Java"),i(),o(110,":"),i(),n(111,"div",26),o(112,"msg = "),n(113,"span",24),o(114,"getNextMessages"),i(),o(115,"()"),i(),n(116,"div",26)(117,"span",25),o(118,"// \u274C No ACK \u2192 stays in PENDING"),i()(),n(119,"div",26)(120,"span",25),o(121,"// \u2192 will retry until max deliveries"),i()(),n(122,"div",26)(123,"span",25),o(124,"// \u2192 then added to DLQ + removed from UI"),i()()()()()()()),s&2&&(r(11),d("pageSize",10)("showNextIndicator",!0),r(4),d("pageSize",10))},dependencies:[y,H,J,K],styles:[".dlq-container[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:20px}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.page-title[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#1e293b;margin:0 0 8px}.page-description[_ngcontent-%COMP%]{font-size:16px;color:#64748b;margin:0;line-height:1.6}.content-layout[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.config-section[_ngcontent-%COMP%]{width:100%}.streams-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto 1fr;gap:16px;min-height:500px}.stream-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:0}.actions-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:200px;min-height:0}.explanation-section[_ngcontent-%COMP%]{margin-top:24px;padding:20px;background:linear-gradient(135deg,#f8fafc,#f1f5f9);border:1px solid #cbd5e1;border-radius:8px;box-shadow:0 2px 4px #0000000d}.explanation-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#1e293b;margin:0 0 16px;display:flex;align-items:center;gap:8px}.xadd-example[_ngcontent-%COMP%]{margin-bottom:16px;padding:12px 16px;background:#1e293b;border-radius:6px;border:1px solid #334155;box-shadow:0 2px 4px #0000001a}.xadd-line[_ngcontent-%COMP%]{font-family:Monaco,Menlo,Courier New,monospace;font-size:14px;line-height:1.8;color:#e2e8f0}.xadd-command[_ngcontent-%COMP%]{color:#f59e0b;font-weight:700;margin-right:8px}.xadd-stream[_ngcontent-%COMP%]{color:#10b981;font-weight:600;margin-right:8px}.xadd-id[_ngcontent-%COMP%]{color:#8b5cf6;font-weight:600;margin-right:8px}.xadd-field[_ngcontent-%COMP%]{color:#3b82f6;font-weight:600;margin-right:4px}.xadd-value[_ngcontent-%COMP%]{color:#ec4899;font-weight:500;margin-right:8px}.pseudocode[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;font-family:Monaco,Menlo,Courier New,monospace;font-size:13px;line-height:1.6}.code-block[_ngcontent-%COMP%]{background:#fff;padding:12px;border-radius:6px;border:1px solid #e2e8f0;box-shadow:0 1px 2px #0000000d}.code-line[_ngcontent-%COMP%]{margin:2px 0;white-space:nowrap}.indent1[_ngcontent-%COMP%]{padding-left:20px}.indent2[_ngcontent-%COMP%]{padding-left:40px}.keyword[_ngcontent-%COMP%]{color:#7c3aed;font-weight:600}.function[_ngcontent-%COMP%]{color:#0891b2;font-weight:500}.comment[_ngcontent-%COMP%]{color:#64748b;font-style:italic}.success[_ngcontent-%COMP%]{color:#16a34a;font-weight:600}.error[_ngcontent-%COMP%]{color:#dc2626;font-weight:600}@media(max-width:1024px){.streams-section[_ngcontent-%COMP%]{grid-template-columns:1fr}.actions-column[_ngcontent-%COMP%]{width:100%}.pseudocode[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media(max-width:768px){.dlq-container[_ngcontent-%COMP%]{padding:12px}.page-title[_ngcontent-%COMP%]{font-size:24px}.bottom-section[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return a})();export{Le as DlqComponent};
